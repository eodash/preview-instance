const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-CzVzbrBP.js","assets/addCommonStyleSheet-DXDJ8TFo.js","assets/map-DiiNQ3pp.js","assets/when-3fO0zp9C.js","assets/dayjs.min-CF9bDMDc.js","assets/templates-CP4OFojK.js","assets/index-ItMkooPk.js","assets/static-BGg7YUw1.js","assets/repeat-Cc-hVx0L.js","assets/directive-CvdRHFdJ.js","assets/directive-helpers-NeOefacU.js","assets/unsafe-html-CN7cyBRn.js","assets/toolcool-range-slider.min-BO3Tl_nj.js","assets/orient2d-DArCjZZA.js","assets/index-BSpBAx16.js"])))=>i.map(i=>d[i]);
import{n as m,av as T,o as f,aw as _,q as v,_ as $,m as O,l as S,a4 as V,b as k,f as b,x as d,w as B,ax as R,Z as M,e as K}from"./main-Q31mW-EY.js";import{i as I,p as i,a as C,c as F,u as n,e as H}from"./templates-CP4OFojK.js";import{i as N}from"./easing-vFiYzKl6.js";import U from"./EodashLayoutSwitcher-DeVM-XVy.js";import"./VTooltip-Bre8yWMT.js";import"./forwardRefs-DH6wnWBi.js";import"./transition-BXTZPH8Z.js";const D=t=>a=>{let r="";return t.forEach(s=>{const e=s.property;if(!s.icon&&!s.unitLabel||!a.properties[e])return;s.icon&&(r+=s.icon);let l=a.properties[e];typeof l=="number"&&!Number.isInteger(l)&&(l=l.toFixed(1)),r+=l,s.unitLabel&&(r+=s.unitLabel)}),r},j=t=>{const r=[{key:"collection",title:"Collections",type:"multiselect",placeholder:"Select collections",inline:!1,filterKeys:m().stac?.map(e=>e.id)||[],...I.value&&{state:{[I.value]:!0}}}],s=t.map(e=>{const l=`properties.${e.property}`;return e.type==="range"?{key:l,title:e.title||e.property,type:"range",expanded:!0,filterKeys:[e.min||0,e.max||100],state:{min:e.min??0,max:e.max??100}}:e.type==="multiselect"?{key:l,title:e.title||e.property,type:"multiselect",placeholder:e.placeholder||`Select ${e.property}`,inline:!1,filterKeys:e.filterKeys||[],state:e.state}:e.type==="select"?{key:l,title:e.title||e.property,type:"select",placeholder:e.placeholder||`Select ${e.title||e.property}`,filterKeys:e.filterKeys||[],state:e.state}:null}).filter(Boolean);return[...r,...s]},G=(t,a)=>{const r=[];return a.forEach(s=>{const e=`properties.${s.property}`,l=t[e];if(l){if(s.type==="range"&&l.state){const{min:o,max:p}=l.state;o!==void 0&&o>(s.min||0)&&r.push(`${s.property}>=${o}`),p!==void 0&&p<(s.max||100)&&r.push(`${s.property}<=${p}`)}else if(s.type==="multiselect"&&l.stringifiedState){const o=l.stringifiedState;o.length>0&&r.push(`${s.property} IN (${o})`)}else if(s.type==="select"&&l.stringifiedState){const o=l.stringifiedState;o&&r.push(`${s.property}='${o}'`)}}}),r.join(" AND ")},J=(t,a,r)=>{const s=m(),e=new URLSearchParams;t.collection?.stringifiedState&&e.append("collections",t.collection.stringifiedState.replaceAll(" ","")),i.value?.lonLatExtent&&r&&e.append("bbox",T([...i.value.lonLatExtent]).join(","));const l=G(t,a);return l&&e.append("filter",l),e.append("limit","100"),`${s.stacEndpoint}/search?${e.toString()}`},Z=(t,a)=>(r,s)=>({url:J(s,t,a),key:"features"});function y(t){let a=i.value?.layers?.find(e=>e.properties?.id==="AnalysisGroup");if(!i.value||!t)return;a||(a={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers"},layers:[]},i.value.layers=[a,...i.value.layers.reverse()]);const r={type:"Vector",properties:{id:"stac-items",title:"STAC Items"},source:{type:"Vector",url:"data:application/geo+json,"+encodeURIComponent(JSON.stringify({type:"FeatureCollection",features:t})),format:"GeoJSON"},style:{"fill-color":"transparent","stroke-color":"#003170"},interactions:[{type:"select",options:{id:"stac-items",condition:"pointermove",style:{"stroke-color":"white","stroke-width":3}}}]};if(a.layers.some(e=>e.properties?.id==="stac-items")){i.value.addOrUpdateLayer(r);return}else a.layers.unshift(r),i.value.layers=[...i.value.layers].reverse()}const q=(t,a)=>{if(!a)return;let r;const s=()=>{clearTimeout(r),r=setTimeout(()=>{t.value?.search()},800)};f(()=>{i.value?.map.on("moveend",s)}),v(()=>{i.value?.map.un("moveend",s)})},z=t=>{const a=()=>_(()=>{y(t.value)});f(()=>{y(t.value),a()})};function Y(t){const a=r=>{const s=r.detail?.feature?.getId();if(!s)return;const e=t.value.items?.find(l=>l.id===s);e&&(t.value.selectedResult=e)};f(()=>{i.value?.addEventListener("select",a)}),v(()=>{i.value?.removeEventListener("select",a)})}const Q=t=>a=>{t.value=a.detail.results,y(t.value)},W=t=>async a=>{const r=a.detail;r&&(t.selectedStac?.id===r.collection?t.selectedItem=r:await t.loadSelectedSTAC(r.collection,!1,r),i.value?.selectInteractions["stac-items"]?.highlightById([r.id],{padding:[100,100,100,100],duration:1200,easing:N}))},A=t=>{i.value?.selectInteractions["stac-items"]?.highlightById([t.detail.id])},w=()=>{i.value?.selectInteractions["stac-items"]?.highlightById([])},X=[".imageProperty",".subTitleProperty",".filterProperties",".items","externalFilter"],ee={slot:"filterstitle",style:{margin:"14px 8px"}},te={slot:"resultstitle",style:{margin:"14px 8px"}},se={__name:"index",props:{title:{type:String,default:"Explore Catalog"},layoutTarget:{type:String,default:"lite"},layoutIcon:{type:String,default:O},filtersTitle:{type:String,default:"Filters:"},resultsTitle:{type:String,default:"Items:"},bboxFilter:{type:Boolean,default:!0},imageProperty:{type:String,default:"assets.thumbnail.href"},filters:{type:Array,default:()=>[{property:"eo:cloud_cover",type:"range",title:"Cloud Cover (%)",min:0,max:100,icon:'<svg style="height: 1rem; transform: translateY(-2px); fill: currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>weather-cloudy</title><path d="M6,19A5,5 0 0,1 1,14A5,5 0 0,1 6,9C7,6.65 9.3,5 12,5C15.43,5 18.24,7.66 18.5,11.03L19,11A4,4 0 0,1 23,15A4,4 0 0,1 19,19H6M19,13H17V12A5,5 0 0,0 12,7C9.5,7 7.45,8.82 7.06,11.19C6.73,11.07 6.37,11 6,11A3,3 0 0,0 3,14A3,3 0 0,0 6,17H19A2,2 0 0,0 21,15A2,2 0 0,0 19,13Z" /></svg>',unitLabel:"%"}]}},async setup(t){let a,r;customElements.get("eox-itemfilter")||([a,r]=S(()=>M(()=>import("./main-CzVzbrBP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),await a,r());const s=t,e=m(),l=V("itemfilter"),o=C([]);[a,r]=S(()=>H.get(e.stacEndpoint+"/search?limit=100").then(h=>o.value=h.data.features)),await a,r();const p=o.value,L=j(s.filters),E=D(s.filters),P=Z(s.filters,s.bboxFilter),g=Q(o),x=W(e);return z(o),q(l,s.bboxFilter),Y(l),v(()=>{e.selectedItem=null}),(h,c)=>(K(),k("span",null,[b(R,{class:"title align-center justify-space-between"},{default:B(()=>[c[4]||(c[4]=d("h4",null,"Catalog Items",-1)),b(U,{target:t.layoutTarget,icon:t.layoutIcon},null,8,["target","icon"])]),_:1,__:[4]}),d("eox-itemfilter",{ref:"itemfilter",titleProperty:"id",".imageProperty":t.imageProperty,".subTitleProperty":n(E),".filterProperties":n(L),".items":n(p),onSelect:c[0]||(c[0]=(...u)=>n(x)&&n(x)(...u)),onFilter:c[1]||(c[1]=(...u)=>n(g)&&n(g)(...u)),"onMouseenter:result":c[2]||(c[2]=(...u)=>n(A)&&n(A)(...u)),"onMouseleave:result":c[3]||(c[3]=(...u)=>n(w)&&n(w)(...u)),externalFilter:n(P)},[d("h4",ee,F(t.filtersTitle),1),d("h4",te,F(t.resultsTitle),1)],40,X)]))}},ue=$(se,[["__scopeId","data-v-64c66d83"]]);export{ue as default};
